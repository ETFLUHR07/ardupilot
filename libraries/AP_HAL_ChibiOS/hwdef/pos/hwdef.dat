# hw definition file for processing by chibios_hwdef.py
# for H743 bootloader

AUTOBUILD_TARGETS None

# MCU class and specific type
MCU STM32H7xx STM32H743xx

# crystal frequency
OSCILLATOR_HZ 0

# define RCC_CR_HSION 1

# board ID for firmware load
APJ_BOARD_ID 139

# timer setting (1, 2, 3, 4, 5, 21)
STM32_ST_USE_TIMER 5


FLASH_SIZE_KB 2048

FLASH_RESERVE_START_KB 128

# order of I2C buses
I2C_ORDER I2C3 

# order of UARTs (and USB)
# 1) Serial 0: console (primary MAVLink)
# 2) Serial 1: telem1
# 3) Serial 2: telem2
# 4) Serial 3: GPS1
# 5) Serial 4: GPS2
# 6) Serial 5: extra (debug)
SERIAL_ORDER UART4 USART3 EMPTY EMPTY EMPTY EMPTY EMPTY

# ESC Battery Monitor
PF13 BATT_VOLTAGE_SENS ADC2
PF14 BATT_CURRENT_SENS ADC2

# internal I2C
PB6 I2C1_SCL I2C3
PB7 I2C1_SDA I2C3

# SPI Bus 5
PF7 SPI5_SCK SPI5 PULLUP
PF8 SPI5_MISO SPI5 PULLUP
PF9 SPI5_MOSI SPI5 PULLUP

# SPI Bus 1
PA5 SPI1_SCK SPI1 PULLUP
PA6 SPI1_MISO SPI1 PULLUP
PA7 SPI1_MOSI SPI1 PULLUP

# External I2C
PA8 I2C3_SCL I2C1
PC9 I2C3_SDA I2C1

# MAVLink
PC10 UART4_TX UART4
PC11 UART4_RX UART4

# Sensor CS
PA4 BARO_CS CS
PF6 IMU_CS CS

# SPI devices
SPIDEV bmp581        SPI5 DEVID2  BARO_CS   MODE2  1*MHZ  2*MHZ
SPIDEV icm20948      SPI1 DEVID1  IMU_CS    MODE3  1*MHZ  2*MHZ



# Altimeter
BARO BMP581 SPI:bmp581

# IMU
IMU Invensensev2 SPI:icm20948 ROTATION_ROLL_180_YAW_90

# GPS (Probably need to add pins for these)
#PA9 USART1_TX USART3
#PA10 USART1_RX USART3

# STLink
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

# Transceiver
PD8 USART3_TX USART3
PD9 USART3_RX USART3
PD11 USART3_CTS USART3
PD12 USART3_RTS USART3

# Radar
#PE7 UART7_RX UART7
#PE8 UART7_TX UART7

# LiDAR
#PC6 USART6_TX USART6
#PC7 USART6_RX USART6

# Motor Pins
#PE11 TIM1_CH2 TIM1 PWM(4) GPIO(50) 
#PE13 TIM1_CH3 TIM1 PWM(3) GPIO(51) BIDIR
#PE14 TIM1_CH4 TIM1 PWM(2) GPIO(52)
#PB10 TIM2_CH3 TIM2 PWM(1) GPIO(53) BIDIR

# Micro SD Card (Needs fixing)
#PB14 SDIO_D0 SDIO
#PB15 SDIO_D1 SDIO
#PG11 SDIO_D2 SDIO
#PB4 SDIO_D3 SDIO
#PC1 SDIO_CK SDIO
#PA0 SDIO_CMD SDIO

define HAL_USE_EMPTY_STORAGE 1
define HAL_STORAGE_SIZE 16384

define HAL_SPI_CHECK_CLOCK_FREQ

# LED's
PG4 LED1 OUTPUT PUSHPULL LOW GPIO(90)
PG5 LED2 OUTPUT PUSHPULL HIGH GPIO(91)
PG6 LED3 OUTPUT PUSHPULL LOW GPIO(92)
PG7 LED4 OUTPUT PUSHPULL HIGH GPIO(93)

#define ALLOW_ARM_NO_COMPASS
define HAL_BARO_ALLOW_INIT_NO_BARO

# define HAL_DISABLE_DCACHE
